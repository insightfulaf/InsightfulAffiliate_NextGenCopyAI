name: Contributor setup check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-setup:
    name: Verify contributor setup files
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Verify CONTRIBUTING.md mentions setup script
      run: |
        if ! grep -q "./scripts/setup.sh" CONTRIBUTING.md; then
          echo "ERROR: CONTRIBUTING.md does not reference ./scripts/setup.sh" >&2
          exit 1
        fi
        echo "CONTRIBUTING.md references setup script"

    - name: Ensure scripts/setup.sh exists and is executable
      run: |
        if [ ! -f scripts/setup.sh ]; then
          echo "ERROR: scripts/setup.sh not found" >&2
          exit 1
        fi
        if [ ! -x scripts/setup.sh ]; then
          echo "WARNING: scripts/setup.sh is not executable; attempting to set exec bit"
          chmod +x scripts/setup.sh || true
        fi
        echo "scripts/setup.sh exists and is executable"

    - name: Verify README links to CONTRIBUTING.md
      run: |
        if ! grep -q "CONTRIBUTING.md" README.md; then
          echo "ERROR: README.md does not reference CONTRIBUTING.md" >&2
          exit 1
        fi
        echo "README.md references CONTRIBUTING.md"

    - name: ShellCheck lint (all shell scripts)
      uses: reviewdog/action-shellcheck@v1
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        reporter: github-pr-review
        shellcheck_flags: -x
        pattern: "**/*.sh"
      continue-on-error: trueÂ 
